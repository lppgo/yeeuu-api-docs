# 云柚酒店门锁管理系统API

|更新时间|2016-03-14|
|:--|:--|
|API版本| 1.1.0|
|状态|正式|
|作者|Kevin \<kevin at yeeuu dot com\>|
|更新纪录|2016/03/14&nbsp;&nbsp;&nbsp;v1.1.0 测试通过，正式上线，文档更新。<br>2016/03/14&nbsp;&nbsp;&nbsp;更新操作逻辑时序图。<br>2016/02/03&nbsp;&nbsp;&nbsp;v1.1.0 版本草案发布。<br>2015/09/16&nbsp;&nbsp;&nbsp;v1.0.0 版本文档发布。|

### 目录

* [基本约定](#基本约定)

* [操作逻辑时序图](#操作逻辑时序图)

* [授权管理API](#授权管理api)   
  * [获取授权](#获取授权)   
  * [更新授权](#更新授权)    
  * [清除授权](#清除授权)   

* [信任登陆API](#信任登陆api)
  * [获取授权登陆Token](#获取授权登陆token) 
  * [微信开门页面跳转](#微信开门页面跳转)

## 基本约定

|约定内容|约定说明|
|:----|:----|
|API调用基地址|__https://hlms.yeeuu.com/api/v1__|
|调用请求数据格式|请求数据格式支持```json```格式。<br>```Content-Type```为```application/json```时会作为json。|
|请求参数|必须参数包括：酒店ID```hotel_id```和密钥```secret```。<br>在调用API接口过程中需要提供此两项数据用于处理。<br>其中```hotel_id```最长30个字符，```secret```最长50个字符。|
|返回数据格式|为方便处理，在成功调用云柚接口后会返回JSON数据。|
|可选参数|如非特殊说明，参数均为必须，不可选择省略或为空。|
|时间戳|本文档中涉及时间表示均以[Unix时间戳](http://baike.baidu.com/view/821460.htm)传递。<br>即所有时间表示为10位数字，时间精度为秒。|
|URL中的{xxx}|在URL中会包含{xxx}类型数据，这些数据代表需要根据实际情况进行替换。<br>通常在一般语言中的```%s```类似。|

## 操作逻辑时序图

具体__举例业务逻辑__如下图所示。下图中红色部分对应各个API调用在实际业务中的应用。

![时序图](https://raw.githubusercontent.com/yeeuu/yeeuu-api-docs/master/img/hotelTimeline.png)

## 授权管理API

### 获取授权

__请求地址：__ ```/{hotel_id}/auth/{room}?secret={secret}```

__请求方式：__ ```GET```

__请求参数说明：__

参数名|参数说明|参数示例
-----|-------|------
hotel_id|酒店ID|123456
room|酒店中存在的房间名|101
secret|调用必须的密钥|1234567890

__返回值说明：__

参数名|参数说明
-----|-------
status|调用成功，此值为200
msg|调用失败时，此处为错误说明
data|返回数据，失败时为空字典

__请求示例__：

```
GET https://hlms.yeeuu.com/api/v1/123456/auth/101?secret=1234567890
```

__返回示例__：

```json
{
    "status": 200,        // 调用成功，此值为200
    "msg": "",            // 调用失败时，此处为错误说明
    "data": {             // 成功时的数据返回，否则为空字典
        "auth": {         // 授权信息
            "phone": [],  // 被授权的手机号码列表，若不存在，该列表为空。
            "end": 0,     // 授权结束时间时间戳
            "start": 0    // 授权生效时间时间戳
        }
    }
}
```

可能出现的```status```错误值：

* __404__ - 该酒店未找到，可能是酒店ID未配置
* __403__ - 密钥传递错误
* __303__ - 房间未匹配到
* __500__ - 服务器端遇到未预测到异常
* __304__ - 由于某些原因，操作未成功

### 更新授权

__请求地址：__ ```/{hotel_id}/auth/{room}?secret={secret}```

__请求方式：__ ```POST```

__请求参数说明：__

参数名|参数说明|参数示例
-----|-------|------
hotel_id|酒店ID|123456
room|酒店中存在的房间名|101
secret|调用必须的密钥|1234567890

__返回值说明：__

参数名|参数说明
-----|-------
status|调用成功，此值为200
msg|调用失败时，此处为错误说明

__请求示例__：

```http
POST https://hlms.yeeuu.com/api/v1/123456/auth/101?secret=1234567890&phone=18600000000
Accept: application/json
Accept-Encoding: gzip, deflate
Content-Type: application/json


{
    "phone": ["18600000000", "13400000000"],
    "start": 1234567890,
    "end": 1235678900,
}
```

__返回示例__：

```json
{
    "status": 200,        // 调用成功，此值为200
    "msg": "",            // 调用失败时，此处为错误说明
}
```

可能出现的```status```错误值：

* __404__ - 该酒店未找到，可能是酒店ID未配置
* __403__ - 密钥传递错误
* __303__ - 房间未匹配到
* __500__ - 服务器端遇到未预测到异常
* __304__ - 由于某些原因，操作未成功
* __400__ - 请求参数不正确

### 删除授权

### 更新授权

__请求地址：__ ```/{hotel_id}/auth/{room}?secret={secret}&phone={phone}```

__请求方式：__ ```DELETE```

__请求参数说明：__

参数名|参数说明|参数示例
-----|-------|------
hotel_id|酒店ID|123456
room|酒店中存在的房间名|101
secret|调用必须的密钥|1234567890
phone|可选参数，用于删除指定的手机号码授权。<br>如果为空或者不填写，默认清空所有。|18600000000

__返回值说明：__

参数名|参数说明
-----|-------
status|调用成功，此值为200
msg|调用失败时，此处为错误说明

__请求示例：__

```http
DELETE https://hlms.yeeuu.com/api/v1/123456/auth/101?secret=1234567890&phone=18600000000
Accept: application/json
Accept-Encoding: gzip, deflate
Content-Type: application/json
```

__返回示例：__

```json
{
    "status": 200,        // 调用成功，此值为200
    "msg": "",            // 调用失败时，此处为错误说明
}
```

可能出现的```status```错误值：

* __404__ - 该酒店未找到，可能是酒店ID未配置
* __403__ - 密钥传递错误
* __303__ - 房间未匹配到
* __500__ - 服务器端遇到未预测到异常
* __304__ - 由于某些原因，操作未成功
* __400__ - 请求参数不正确

## 获取信任登陆API

### 获取授权登陆Token

注意： 获取到的Token有效次数仅为一次，有效时间10分钟以内。

__请求地址：__ ```/{hotel_id}/token/{phone}?secret={secret}```

__请求方式：__ ```GET```

__请求参数说明：__

参数名|参数说明|参数示例
-----|-------|------
hotel_id|酒店ID|123456
phone|用户手机号码|18600000000
secret|调用必须的密钥|1234567890

__返回值说明：__

参数名|参数说明
-----|-------
status|调用成功，此值为200
msg|调用失败时，此处为错误说明
data|返回数据，失败时为空字典

__请求示例__：

```
GET https://hlms.yeeuu.com/api/v1/123456/token/18600000000?secret=1234567890
```

__返回示例__：

```json
{
    "status": 200,        // 调用成功，此值为200
    "msg": "",            // 调用失败时，此处为错误说明
    "data": {
        "token": "xxxx"   // 返回TOKEN
    }      
}
```

可能出现的```status```错误值：

* __404__ - 该酒店未找到，可能是酒店ID未配置
* __403__ - 密钥传递错误
* __500__ - 服务器端遇到未预测到异常

### 微信开门页面跳转

注意，本页面非API调用方式，请使用```HTTP Redirect```方式进行跳转。

**URL生成方式：**

地址：```http://hlms.yeeuu.com/weixin/?token={token}&phone={phone}&hotel_id={hotel_id}```

__请求参数说明：__

参数名|参数说明|参数示例
-----|-------|------
hotel_id|酒店ID|123456
token|可以通过[获取授权登陆Token](#获取授权登陆token)方式获取|xxxxx
phone|用户手机号码，可以选择全部显示或者使用```*```隐藏中间4位|123****8900

__URL示例：__

```
http://hlms.yeeuu.com/weixin/?token=xxxxx&phone=123****8900&hotel_id=123456
```

如果登陆成功，则跳过登陆页面。
